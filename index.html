<title>Gangstar Empire Tycoon</title>
<script type="importmap">
{
  "imports": {
    "websim": "https://cdn.websim.ai/websim.js"
  }
}
</script>
<script type="module">
  import { WebsimSocket } from 'websim';
  window.WebsimSocket = WebsimSocket;
</script>

<audio id="bgm" loop>
  <source src="audio/gang 4 life.mp3" type="audio/mpeg">
</audio>

<audio id="assign-sound">
  <source src="audio/assign.mp3" type="audio/mpeg">
</audio>

<audio id="recruit-sound">
  <source src="recruitsoundeffect.mp3" type="audio/mpeg">
</audio>

<audio id="gang-war-sound">
  <source src="gunshots.mp3" type="audio/mpeg">
</audio>

<style>
:root {
  --main-bg: #1a1a1a;
  --text: #ffffff;
  --accent: #ff4d4d;
  --secondary: #4d4d4d;
}

body {
  background: var(--main-bg);
  color: var(--text);
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 20px;
}

/* Enhanced Loading Screen */
#loading-screen {
  background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
  transition: opacity 0.5s ease-out;
}

#loading-screen svg {
  filter: drop-shadow(0 0 10px rgba(255, 77, 77, 0.5));
  transform-origin: center;
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

#loading-screen h2 {
  font-family: 'Arial Black', sans-serif;
  text-transform: uppercase;
  letter-spacing: 3px;
  color: #ff4d4d;
  text-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
}

/* Enhanced Title Screen */
#title-screen {
  background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
  transition: all 0.3s ease;
}

#title-screen h1 {
  font-family: 'Arial Black', sans-serif;
  text-transform: uppercase;
  letter-spacing: 5px;
  text-shadow: 0 0 20px rgba(255, 77, 77, 0.7);
  animation: glow 2s ease-in-out infinite;
}

@keyframes glow {
  0% { text-shadow: 0 0 20px rgba(255, 77, 77, 0.7); }
  50% { text-shadow: 0 0 30px rgba(255, 77, 77, 0.9); }
  100% { text-shadow: 0 0 20px rgba(255, 77, 77, 0.7); }
}

.save-slot {
  background: linear-gradient(145deg, #4d4d4d, #3d3d3d);
  border: 2px solid rgba(255, 77, 77, 0.3);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

.save-slot:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

.save-slot h3 {
  color: #ff4d4d;
  font-family: 'Arial Black', sans-serif;
  margin-bottom: 15px;
  text-shadow: 0 0 10px rgba(255, 77, 77, 0.3);
}

.save-slot button {
  background: linear-gradient(145deg, #ff4d4d, #ff3333);
  padding: 10px 20px;
  margin: 5px;
  border: none;
  border-radius: 5px;
  color: white;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  transition: all 0.3s ease;
}

.save-slot button:hover {
  background: linear-gradient(145deg, #ff3333, #ff1a1a);
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(255, 77, 77, 0.3);
}

/* Version Info Styling */
#title-screen .version-info {
  background: rgba(0, 0, 0, 0.3);
  padding: 20px;
  border-radius: 10px;
  border-left: 4px solid #ff4d4d;
  margin: 20px;
}

#title-screen .version-info h3 {
  color: #ff4d4d;
  margin-bottom: 10px;
}

#title-screen .version-info p {
  color: #999;
  margin: 5px 0;
}

#title-screen .version-info ul {
  color: #999;
  margin: 10px 0;
  padding-left: 20px;
}

#title-screen .version-info li {
  margin: 5px 0;
  position: relative;
  padding-left: 20px;
}

#title-screen .version-info li:before {
  content: 'â€¢';
  color: #ff4d4d;
  position: absolute;
  left: 0;
  top: 0;
}

/* Enhanced Resource Container Styling */
.resources {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin: 30px 0;
}

.resource {
  background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
  border: 2px solid rgba(255, 77, 77, 0.2);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

.resource:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
  border-color: rgba(255, 77, 77, 0.4);
}

.resource h3 {
  color: var(--accent);
  font-size: 1.2em;
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.resource span {
  font-size: 1.5em;
  font-weight: bold;
  color: #fff;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
}

.production-rate {
  margin-top: 10px;
  font-size: 0.9em;
  color: #00ff00;
  text-shadow: 0 0 8px rgba(0, 255, 0, 0.3);
}

/* Enhanced Building Styling */
.buildings {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 25px;
  margin: 30px 0;
}

.building {
  background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
  border: 2px solid rgba(255, 77, 77, 0.2);
  border-radius: 15px;
  padding: 25px;
  position: relative;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

.building:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
  border-color: rgba(255, 77, 77, 0.4);
}

.building h3 {
  color: var(--accent);
  font-size: 1.3em;
  margin-bottom: 15px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.building p {
  color: #ccc;
  margin: 10px 0;
  font-size: 1.1em;
}

/* Enhanced Assign Modal Styling */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: none;
  justify-content: center;
  align-items: center;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(8px);
  z-index: 1000;
}

.modal-content {
  background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
  border: 2px solid rgba(255, 77, 77, 0.3);
  border-radius: 20px;
  padding: 30px;
  max-width: 800px;
  width: 90%;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
  max-height: 90vh;
  overflow-y: auto;
}

.homies-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin: 20px 0;
  max-height: 60vh;
  overflow-y: auto;
  padding: 10px;
}

.homie {
  background: linear-gradient(145deg, #363636, #2a2a2a);
  border: 1px solid rgba(255, 77, 77, 0.2);
  border-radius: 12px;
  padding: 20px;
  transition: all 0.3s ease;
}

.homie:hover {
  transform: translateY(-3px);
  border-color: rgba(255, 77, 77, 0.4);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.homie h4 {
  color: #fff;
  font-size: 1.2em;
  margin-bottom: 10px;
}

/* Enhanced Recruit Section Styling */
.recruit-section {
  background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
  border: 2px solid rgba(255, 77, 77, 0.2);
  border-radius: 20px;
  padding: 30px;
  margin: 30px 0;
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
}

.recruit-section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.recruit-section-header h2 {
  color: var(--accent);
  font-size: 1.8em;
  text-transform: uppercase;
  letter-spacing: 2px;
}

#recruit-timer {
  color: #ccc;
  font-size: 1.1em;
  margin-top: 5px;
}

.recruit-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 25px;
  margin-top: 25px;
}

.recruit-card {
  background: linear-gradient(145deg, #363636, #2a2a2a);
  border: 1px solid rgba(255, 77, 77, 0.2);
  border-radius: 15px;
  padding: 25px;
  text-align: center;
  transition: all 0.3s ease;
}

.recruit-card:hover {
  transform: translateY(-5px);
  border-color: rgba(255, 77, 77, 0.4);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
}

.recruit-card h3 {
  color: #fff;
  font-size: 1.4em;
  margin-bottom: 15px;
}

.recruit-card p {
  color: #ccc;
  margin: 10px 0;
  font-size: 1.1em;
}

.recruit-cost {
  margin: 15px 0;
  padding: 10px;
  background: rgba(255, 77, 77, 0.1);
  border-radius: 8px;
}

/* Enhanced Button Styling */
button {
  background: linear-gradient(145deg, var(--accent), #ff3333);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  background: linear-gradient(145deg, #ff3333, #ff1a1a);
}

.refresh-button {
  background: linear-gradient(145deg, #4CAF50, #45a049);
}

.refresh-button:hover {
  background: linear-gradient(145deg, #45a049, #3d8b40);
}

.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 10px 20px;
  background: var(--accent);
  border-radius: 4px;
  display: none;
}

#loading-screen {
  position: fixed; 
  top: 0; 
  left: 0; 
  width: 100%; 
  height: 100%; 
  background: #1a1a1a; 
  display: flex; 
  flex-direction: column; 
  justify-content: center; 
  align-items: center; 
  z-index: 1000;
}

#title-screen {
  position: fixed; 
  top: 0; 
  left: 0; 
  width: 100%; 
  height: 100%; 
  background: #1a1a1a; 
  display: none; 
  flex-direction: column; 
  justify-content: center; 
  align-items: center; 
  z-index: 999;
}

.save-slot {
  background: #4d4d4d; 
  padding: 20px; 
  border-radius: 8px; 
  width: 300px; 
  text-align: center;
}

/* Version Modal Styling */
.version-modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
  border: 2px solid rgba(255, 77, 77, 0.3);
  border-radius: 20px;
  padding: 30px;
  z-index: 1001;
  max-width: 600px;
  width: 90%;
  display: none;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}

.version-modal .close-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  font-size: 24px;
  cursor: pointer;
  color: var(--accent);
}

/* Remove the audio controls styling */
.audio-controls {
  display: none; /* Or you can completely remove this CSS block */
}

/* Conquest Section Styling */
.conquest-section {
  background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
  border: 2px solid rgba(255, 77, 77, 0.2);
  border-radius: 20px;
  padding: 30px;
  margin: 30px 0;
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
}

.conquest-button {
  background: linear-gradient(145deg, #ff4d4d, #cc0000);
  border: none;
  padding: 15px 30px;
  border-radius: 10px;
  font-size: 1.2em;
  text-transform: uppercase;
  letter-spacing: 2px;
  transition: all 0.3s ease;
}

.conquest-button:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 16px rgba(255, 77, 77, 0.3);
}

.conquest-modal {
  max-width: 1000px !important;
}

.territories-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin: 20px 0;
  max-height: 60vh;
  overflow-y: auto;
  padding: 15px;
}

.territory-card {
  background: linear-gradient(145deg, #363636, #2a2a2a);
  border: 1px solid rgba(255, 77, 77, 0.2);
  border-radius: 12px;
  padding: 20px;
  transition: all 0.3s ease;
}

.territory-card:hover {
  transform: translateY(-3px);
  border-color: rgba(255, 77, 77, 0.4);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.territory-card.owned {
  border: 1px solid rgba(0, 255, 0, 0.4);
}

.territory-card.under-attack {
  border: 1px solid rgba(255, 255, 0, 0.4);
  animation: pulse 2s infinite;
}

.conquest-controls {
  display: flex;
  gap: 15px;
  margin: 20px 0;
}

.homies-input {
  background: #2d2d2d;
  border: 1px solid rgba(255, 77, 77, 0.3);
  border-radius: 8px;
  padding: 10px;
  color: white;
  width: 100px;
}

/* Custom Scrollbar Styling */
::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: var(--main-bg);
  border-radius: 6px;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(145deg, var(--accent), #cc0000);
  border-radius: 6px;
  border: 2px solid var(--main-bg);
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(145deg, #ff3333, #990000);
}

::-webkit-scrollbar-corner {
  background: var(--main-bg);
}

/* For Firefox */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--accent) var(--main-bg);
}
</style>
</head>
<body>
<div id="loading-screen">
  <svg width="100" height="100" viewBox="0 0 100 100">
    <circle cx="50" cy="50" r="40" stroke="#ff4d4d" stroke-width="8" fill="none">
      <animate attributeName="stroke-dasharray" from="0 251.2" to="251.2 0" dur="2s" repeatCount="indefinite"/>
      <animate attributeName="stroke-dashoffset" from="0" to="251.2" dur="2s" repeatCount="indefinite"/>
    </circle>
  </svg>
  <h2 style="color: #fff; margin-top: 20px;">Loading...</h2>
</div>

<div id="version-modal" class="version-modal">
  <span class="close-btn" onclick="closeVersionModal()">&times;</span>
  <h3>Gangstar Empire Tycoon</h3>
  <p>Version: 2.0 Live</p>
  <p>Last Updated: 2024</p>
  <ul>
    <li>Added Multiplayer Conquest Mode</li>
    <li>Added Gang Territory Control System</li>
    <li>Added Distillery Den & Gasoline Syndicate</li>
    <li>Added liquor & gasoline resources</li>
    <li>Added save system</li>
    <li>Increased homie limit to 100</li>
    <li>Added recruitment system</li>
    <li>Added gang wars</li>
    <li>Fixed recruit timer initialization bug</li>
    <li>Fixed homie assignment system</li>
    <li>Fixed building capacity display</li>
  </ul>
  <button onclick="closeVersionModal()">Continue to Game</button>
</div>

<div id="title-screen">
  <div style="position: absolute; top: 20px; left: 20px; text-align: left;">
    <div class="version-info">
      <h3>Gangstar Empire Tycoon</h3>
      <p>Version: 2.0 Live</p>
      <p>Last Updated: 2024</p>
      <ul>
        <li>Added Multiplayer Conquest Mode</li>
        <li>Added Gang Territory Control System</li>
        <li>Added Distillery Den & Gasoline Syndicate</li>
        <li>Added liquor & gasoline resources</li>
        <li>Added save system</li>
        <li>Increased homie limit to 100</li>
        <li>Added recruitment system</li>
        <li>Added gang wars</li>
        <li>Fixed recruit timer initialization bug</li>
        <li>Fixed homie assignment system</li>
        <li>Fixed building capacity display</li>
      </ul>
    </div>
  </div>
  <h1 style="color: #ff4d4d; font-size: 48px; margin-bottom: 40px;">Gangstar Empire Tycoon</h1>
  <div id="save-slots" style="display: flex; flex-direction: column; gap: 20px;">
    <div class="save-slot">
      <h3>Save Slot 1</h3>
      <button onclick="loadSaveSlot(1)" id="slot1-load">Load Game</button>
      <button onclick="startNewGame(1)">New Game</button>
    </div>
    <div class="save-slot">
      <h3>Save Slot 2</h3>
      <button onclick="loadSaveSlot(2)" id="slot2-load">Load Game</button>
      <button onclick="startNewGame(2)">New Game</button>
    </div>
    <div class="save-slot">
      <h3>Save Slot 3</h3>
      <button onclick="loadSaveSlot(3)" id="slot3-load">Load Game</button>
      <button onclick="startNewGame(3)">New Game</button>
    </div>
  </div>
</div>

<div id="game-container" style="display: none;">
<h1>Gangstar Empire Tycoon</h1>

<div class="resources">
  <div class="resource">
    <h3>Cash</h3>
    <span id="cash">$1000</span>
    <div class="production-rate">+<span id="cash-per-second">0</span>/s</div>
  </div>
  <div class="resource">
    <h3>Drugs</h3>
    <span id="drugs">100</span>
    <div class="production-rate">+<span id="drugs-per-second">0</span>/s</div>
  </div>
  <div class="resource">
    <h3>Weapons</h3>
    <span id="weapons">50</span>
    <div class="production-rate">+<span id="weapons-per-second">0</span>/s</div>
  </div>
  <div class="resource">
    <h3>Respect</h3>
    <span id="respect">10</span>
    <div class="production-rate">+<span id="respect-per-second">0</span>/s</div>
  </div>
  <div class="resource">
    <h3>Liquor</h3>
    <span id="liquor">0</span>
    <div class="production-rate">+<span id="liquor-per-second">0</span>/s</div>
  </div>
  <div class="resource">
    <h3>Gasoline</h3>
    <span id="gasoline">0</span>
    <div class="production-rate">+<span id="gasoline-per-second">0</span>/s</div>
  </div>
</div>

<div class="buildings">
  <div class="building">
    <h3>Drug Lab</h3>
    <p>Production: 1 drug/s</p>
    <p>Assigned Homies: <span id="drug-lab-homies">0/100</span></p>
    <button onclick="openAssignModal('drug-lab')">Assign Homies</button>
  </div>
  <div class="building">
    <h3>Weapons Factory</h3>
    <p>Production: 1 weapon/s</p>
    <p>Assigned Homies: <span id="weapons-factory-homies">0/100</span></p>
    <button onclick="openAssignModal('weapons-factory')">Assign Homies</button>
  </div>
  <div class="building">
    <h3>Counterfeit</h3>
    <p>Production: $20/s</p>
    <p>Assigned Homies: <span id="counterfeit-homies">0/100</span></p>
    <button onclick="openAssignModal('counterfeit')">Assign Homies</button>
  </div>
  <div class="building">
    <h3>Gangbangers Base</h3>
    <p>Production: 1 respect/s</p>
    <p>Assigned Homies: <span id="gangbangers-base-homies">0/100</span></p>
    <button onclick="openAssignModal('gangbangers-base')">Assign Homies</button>
  </div>
  <div class="building">
    <h3>Hospital</h3>
    <p>Production: 1 health/s</p>
    <p>Assigned Homies: <span id="hospital-homies">0/100</span></p>
    <button onclick="openAssignModal('hospital')">Assign Homies</button>
  </div>
  <div class="building">
    <h3>Distillery Den</h3>
    <p>Production: 1 liquor/s</p>
    <p>Assigned Homies: <span id="distillery-den-homies">0/100</span></p>
    <button onclick="openAssignModal('distillery-den')">Assign Homies</button>
  </div>
  <div class="building">
    <h3>Gasoline Syndicate</h3>
    <p>Production: 1 gasoline/s</p>
    <p>Assigned Homies: <span id="gasoline-syndicate-homies">0/100</span></p>
    <button onclick="openAssignModal('gasoline-syndicate')">Assign Homies</button>
  </div>
</div>

<div class="gang-wars">
  <h2>Gang Wars</h2>
  <button onclick="startGangWar()">Start Gang War</button>
  <p>Available Homies for War: <span id="available-homies">5</span></p>
</div>

<div class="conquest-section">
  <h2>Gang Hideout Conquest</h2>
  <button onclick="openConquestModal()" class="conquest-button">View Gang Territories</button>
</div>

<div id="conquestModal" class="modal">
  <div class="modal-content conquest-modal">
    <h2>Gang Territories</h2>
    <div class="territories-grid" id="territories-grid">
      <!-- Territory cards will be dynamically added here -->
    </div>
    <div class="conquest-controls">
      <input type="number" id="homies-to-send" min="1" max="100" value="1" class="homies-input">
      <button onclick="sendHomies()" class="conquest-action">Send Homies</button>
    </div>
    <button onclick="closeConquestModal()" class="close-modal">Close</button>
  </div>
</div>

<div class="recruit-section">
  <div class="recruit-section-header">
    <div>
      <h2>Recruit New Homies</h2>
      <span id="recruit-timer"></span>
    </div>
    <button class="refresh-button" onclick="refreshRecruits(true)">Force Refresh</button>
  </div>
  <div class="recruit-list" id="recruit-list">
    <!-- Recruit cards will be dynamically added here -->
  </div>
</div>

<div id="assignModal" class="modal">
  <div class="modal-content">
    <h2>Assign Homies</h2>
    <div class="homies-list" id="homies-list">
      <!-- Homies will be dynamically added here -->
    </div>
    <button onclick="closeAssignModal()">Close</button>
  </div>
</div>

<div class="notification" id="notification"></div>

<script>
let currentSaveSlot = null;

const gangNicknameGenerator = {
  adjectives: [
    'Shadow', 'Iron', 'Silent', 'Dark', 'Blood', 'Ghost', 'Steel', 'Thunder', 'Mad', 'Wild',
    'Crazy', 'Quick', 'Deadly', 'Night', 'Street', 'Urban', 'Silver', 'Gold', 'Black', 'Red',
    'Savage', 'Lone', 'Fierce', 'Bold', 'Grim', 'Raw', 'Pure', 'Prime', 'Swift', 'Cold',
    'Brutal', 'Royal', 'Fatal', 'Ice', 'Fire', 'Storm', 'Heavy', 'Light', 'Neon', 'Toxic',
    'Double', 'Triple', 'Zero', 'Alpha', 'Omega', 'Delta', 'Rogue', 'Lost', 'Found', 'True'
  ],
  
  nouns: [
    'Blade', 'Wolf', 'Snake', 'Dragon', 'Tiger', 'Hawk', 'Eagle', 'Fist', 'Knight', 'King',
    'Prince', 'Duke', 'Boss', 'Lord', 'Ghost', 'Phantom', 'Shadow', 'Beast', 'Hunter', 'Warrior',
    'Demon', 'Angel', 'Devil', 'Saint', 'Rider', 'Runner', 'Striker', 'Ninja', 'Samurai', 'Bandit',
    'Raven', 'Phoenix', 'Lion', 'Bear', 'Cobra', 'Viper', 'Shark', 'Panther', 'Fox', 'Wolf',
    'Reaper', 'Grave', 'Stone', 'Steel', 'Hammer', 'Blade', 'Knife', 'Gun', 'Shot', 'Bullet'
  ],

  generateNickname() {
    const adjective = this.adjectives[Math.floor(Math.random() * this.adjectives.length)];
    const noun = this.nouns[Math.floor(Math.random() * this.nouns.length)];
    return `${adjective} ${noun}`;
  },

  // Generate a unique nickname not already in use
  generateUniqueNickname(existingNames) {
    let nickname;
    do {
      nickname = this.generateNickname();
    } while (existingNames.includes(nickname));
    return nickname;
  }
};

const gameState = {
  resources: {
    cash: 1000,
    drugs: 100,
    weapons: 50,
    respect: 10,
    health: 0,
    liquor: 0,
    gasoline: 0
  },
  buildings: {
    'drug-lab': {
      name: 'Drug Lab',
      homies: [],
      maxHomies: 100,
      production: 1
    },
    'weapons-factory': {
      name: 'Weapons Factory',
      homies: [],
      maxHomies: 100,
      production: 1
    },
    'counterfeit': {
      name: 'Counterfeit',
      homies: [],
      maxHomies: 100,
      production: 20
    },
    'gangbangers-base': {
      name: 'Gangbangers Base',
      homies: [],
      maxHomies: 100,
      production: 1
    },
    'hospital': {
      name: 'Hospital',
      homies: [],
      maxHomies: 100,
      production: 1
    },
    'distillery-den': {
      name: 'Distillery Den',
      homies: [],
      maxHomies: 100,
      production: 1
    },
    'gasoline-syndicate': {
      name: 'Gasoline Syndicate',
      homies: [],
      maxHomies: 100,
      production: 1
    }
  },
  homies: [
    { id: 1, name: 'Big Mike', strength: 10, assigned: false },
    { id: 2, name: 'Crazy Joe', strength: 8, assigned: false },
    { id: 3, name: 'Silent Sam', strength: 12, assigned: false },
    { id: 4, name: 'Quick Rick', strength: 7, assigned: false },
    { id: 5, name: 'Mad Dog', strength: 15, assigned: false }
  ],
  recruitSystem: {
    nextRefresh: new Date().getTime() + 3600000,
    refreshInterval: 3600000,
    baseRecruits: [
      { id: 6, name: 'Street Boss', strength: 20, cost: 2000, weaponsCost: 20 },
      { id: 7, name: 'Shadow Ninja', strength: 15, cost: 1500, weaponsCost: 15 },
      { id: 8, name: 'Thunder Fist', strength: 18, cost: 1800, weaponsCost: 18 },
      { id: 9, name: 'Ghost Runner', strength: 12, cost: 1200, weaponsCost: 12 },
      { id: 10, name: 'Iron Duke', strength: 25, cost: 2500, weaponsCost: 25 },
      { id: 11, name: 'Steel Knuckle', strength: 22, cost: 2200, weaponsCost: 22 },
      { id: 12, name: 'Dark Angel', strength: 19, cost: 1900, weaponsCost: 19 },
      { id: 13, name: 'Night Hawk', strength: 17, cost: 1700, weaponsCost: 17 },
      { id: 14, name: 'Silent Blade', strength: 21, cost: 2100, weaponsCost: 21 },
      { id: 15, name: 'Blood Dragon', strength: 23, cost: 2300, weaponsCost: 23 }
    ]
  },
  territories: {
    selectedTerritory: null,
    attackingForces: {}
  },
  potentialRecruits: [
    { id: 6, name: 'Street Boss', strength: 20, cost: 2000, weaponsCost: 20 },
    { id: 7, name: 'Shadow Ninja', strength: 15, cost: 1500, weaponsCost: 15 },
    { id: 8, name: 'Thunder Fist', strength: 18, cost: 1800, weaponsCost: 18 },
    { id: 9, name: 'Ghost Runner', strength: 12, cost: 1200, weaponsCost: 12 },
    { id: 10, name: 'Iron Duke', strength: 25, cost: 2500, weaponsCost: 25 }
  ]
};

const audio = {
  bgm: document.getElementById('bgm'),
  assignSound: document.getElementById('assign-sound'),
  recruitSound: document.getElementById('recruit-sound'),
  gangWarSound: document.getElementById('gang-war-sound')
};

function saveGame() {
  if (!currentSaveSlot) return;
  
  const saveData = {
    resources: gameState.resources,
    buildings: gameState.buildings,
    homies: gameState.homies,
    potentialRecruits: gameState.potentialRecruits,
    recruitSystem: gameState.recruitSystem,
    lastSaved: new Date().toISOString()
  };
  
  localStorage.setItem(`gangstar-save-${currentSaveSlot}`, JSON.stringify(saveData));
  showNotification('Game saved!');
}

function loadSaveSlot(slot) {
  const savedData = localStorage.getItem(`gangstar-save-${slot}`);
  
  if (!savedData) {
    showNotification('No save data found!');
    return;
  }
  
  const data = JSON.parse(savedData);
  gameState.resources = data.resources;
  gameState.buildings = data.buildings;
  gameState.homies = data.homies;
  gameState.potentialRecruits = data.potentialRecruits;
  gameState.recruitSystem = data.recruitSystem;
  
  currentSaveSlot = slot;
  document.getElementById('title-screen').style.display = 'none';
  document.getElementById('game-container').style.display = 'block';
  
  updateResources();
  updateHomiesDisplay();
  updateRecruitList();
  showNotification('Game loaded!');
}

function startNewGame(slot) {
  currentSaveSlot = slot;
  gameState.resources = {
    cash: 1000,
    drugs: 100,
    weapons: 50,
    respect: 10,
    health: 0,
    liquor: 0,
    gasoline: 0
  };
  
  Object.values(gameState.buildings).forEach(building => {
    building.homies = [];
  });
  
  gameState.homies = [
    { id: 1, name: 'Big Mike', strength: 10, assigned: false },
    { id: 2, name: 'Crazy Joe', strength: 8, assigned: false },
    { id: 3, name: 'Silent Sam', strength: 12, assigned: false },
    { id: 4, name: 'Quick Rick', strength: 7, assigned: false },
    { id: 5, name: 'Mad Dog', strength: 15, assigned: false }
  ];

  gameState.recruitSystem = {
    nextRefresh: new Date().getTime() + 3600000,
    refreshInterval: 3600000,
    baseRecruits: gameState.recruitSystem.baseRecruits
  };
  
  gameState.potentialRecruits = [
    { id: 6, name: 'Street Boss', strength: 20, cost: 2000, weaponsCost: 20 },
    { id: 7, name: 'Shadow Ninja', strength: 15, cost: 1500, weaponsCost: 15 },
    { id: 8, name: 'Thunder Fist', strength: 18, cost: 1800, weaponsCost: 18 },
    { id: 9, name: 'Ghost Runner', strength: 12, cost: 1200, weaponsCost: 12 },
    { id: 10, name: 'Iron Duke', strength: 25, cost: 2500, weaponsCost: 25 }
  ];
  
  document.getElementById('title-screen').style.display = 'none';
  document.getElementById('game-container').style.display = 'block';
  
  updateResources();
  updateHomiesDisplay();
  updateRecruitList();
  showNotification('New game started!');

  audio.bgm.play().catch(error => console.log("Audio autoplay prevented"));
}

function updateResources() {
  document.getElementById('cash').textContent = `$${gameState.resources.cash}`;
  document.getElementById('drugs').textContent = gameState.resources.drugs;
  document.getElementById('weapons').textContent = gameState.resources.weapons;
  document.getElementById('respect').textContent = gameState.resources.respect;
  document.getElementById('liquor').textContent = gameState.resources.liquor;
  document.getElementById('gasoline').textContent = gameState.resources.gasoline;
  document.getElementById('available-homies').textContent = 
    gameState.homies.filter(h => !h.assigned).length;
}

function updateProductionRates() {
  const rates = {
    cash: 0,
    drugs: 0,
    weapons: 0,
    respect: 0,
    liquor: 0,
    gasoline: 0
  };

  Object.entries(gameState.buildings).forEach(([buildingId, building]) => {
    const production = building.production * building.homies.length;
    
    switch(buildingId) {
      case 'drug-lab':
        rates.drugs += production;
        break;
      case 'weapons-factory':
        rates.weapons += production;
        break;
      case 'counterfeit':
        rates.cash += production;
        break;
      case 'gangbangers-base':
        rates.respect += production;
        break;
      case 'distillery-den':
        rates.liquor += production;
        break;
      case 'gasoline-syndicate':
        rates.gasoline += production;
        break;
    }
  });

  document.getElementById('cash-per-second').textContent = rates.cash;
  document.getElementById('drugs-per-second').textContent = rates.drugs;
  document.getElementById('weapons-per-second').textContent = rates.weapons;
  document.getElementById('respect-per-second').textContent = rates.respect;
  document.getElementById('liquor-per-second').textContent = rates.liquor;
  document.getElementById('gasoline-per-second').textContent = rates.gasoline;
}

function openAssignModal(buildingId) {
  gameState.currentBuilding = buildingId;
  const modal = document.getElementById('assignModal');
  const homiesList = document.getElementById('homies-list');
  homiesList.innerHTML = '';
  
  const unassignedHomies = gameState.homies.filter(homie => !homie.assigned);
  
  if (unassignedHomies.length === 0) {
    homiesList.innerHTML = '<p>No available homies to assign!</p>';
  } else {
    unassignedHomies.forEach(homie => {
      const homieElement = document.createElement('div');
      homieElement.className = 'homie';
      homieElement.innerHTML = `
        <h4>${homie.name}</h4>
        <p>Strength: ${homie.strength}</p>
        <button onclick="assignHomie(${homie.id})">Assign</button>
      `;
      homiesList.appendChild(homieElement);
    });
  }
  
  modal.style.display = 'flex'; 
}

function closeAssignModal() {
  const modal = document.getElementById('assignModal');
  modal.style.display = 'none';
  gameState.currentBuilding = null;
}

function assignHomie(homieId) {
  const building = gameState.buildings[gameState.currentBuilding];
  if (building.homies.length >= building.maxHomies) {
    showNotification('Building is at maximum capacity!');
    return;
  }
  
  const homie = gameState.homies.find(h => h.id === homieId);
  if (!homie) return;
  
  if (homie.assigned) {
    showNotification('This homie is already assigned!');
    return;
  }
  
  building.homies.push(homieId);
  homie.assigned = true;
  homie.assignedTo = gameState.currentBuilding;
  
  document.getElementById(`${gameState.currentBuilding}-homies`).textContent = 
    `${building.homies.length}/${building.maxHomies}`;
    
  closeAssignModal();
  updateHomiesDisplay();
  showNotification(`${homie.name} assigned to ${building.name}!`);
  
  audio.assignSound.currentTime = 0;
  audio.assignSound.play().catch(error => console.log("Audio autoplay prevented"));
}

function updateHomiesDisplay() {
  Object.keys(gameState.buildings).forEach(buildingId => {
    const building = gameState.buildings[buildingId];
    document.getElementById(`${buildingId}-homies`).textContent = 
      `${building.homies.length}/${building.maxHomies}`;
  });
}

function startGangWar() {
  audio.gangWarSound.currentTime = 0;
  audio.gangWarSound.play().catch(error => console.log("Audio autoplay prevented"));

  const availableHomies = gameState.homies.filter(h => !h.assigned);
  if (availableHomies.length === 0) {
    showNotification('No homies available for gang war!');
    return;
  }
  
  const totalStrength = availableHomies.reduce((sum, homie) => sum + homie.strength, 0);
  const success = Math.random() < (totalStrength / 100);
  
  if (success) {
    const reward = Math.floor(Math.random() * 1000) + 500;
    gameState.resources.cash += reward;
    gameState.resources.respect += 5;
    showNotification(`Gang war won! Earned $${reward} and 5 respect!`);
  } else {
    gameState.resources.respect -= 2;
    showNotification('Gang war lost! Lost 2 respect.');
  }
  
  updateResources();
}

function showNotification(message) {
  const notification = document.getElementById('notification');
  notification.textContent = message;
  notification.style.display = 'block';
  setTimeout(() => {
    notification.style.display = 'none';
  }, 3000);
}

function recruitHomie(recruitId) {
  const recruit = gameState.potentialRecruits.find(r => r.id === recruitId);
  
  if (!recruit) {
    showNotification('Recruit not found!');
    return;
  }
  
  if (gameState.resources.cash < recruit.cost) {
    showNotification('Not enough cash to recruit!');
    return;
  }
  
  if (gameState.resources.weapons < recruit.weaponsCost) {
    showNotification('Not enough weapons to equip recruit!');
    return;
  }
  
  gameState.resources.cash -= recruit.cost;
  gameState.resources.weapons -= recruit.weaponsCost;
  
  const newHomie = {
    id: recruit.id,
    name: recruit.name,
    strength: recruit.strength,
    assigned: false
  };
  
  gameState.homies.push(newHomie);
  
  gameState.potentialRecruits = gameState.potentialRecruits.filter(r => r.id !== recruitId);
  
  showNotification(`Successfully recruited ${recruit.name}!`);
  
  audio.recruitSound.currentTime = 0;
  audio.recruitSound.play().catch(error => console.log("Audio autoplay prevented"));
  
  updateResources();
  updateRecruitList();
}

function refreshRecruits(force = false) {
  const now = new Date().getTime();
  
  if (force || now >= gameState.recruitSystem.nextRefresh) {
    // Get all existing homie names
    const existingNames = [
      ...gameState.homies.map(h => h.name),
      ...gameState.potentialRecruits.map(r => r.name)
    ];
    
    // Generate 5 new recruits with random names and stats
    gameState.potentialRecruits = Array.from({length: 5}, () => {
      const strength = Math.floor(Math.random() * 20) + 10; // Random strength between 10-30
      const cost = strength * 100; // Cost based on strength
      const weaponsCost = Math.ceil(strength / 2); // Weapons cost based on strength
      
      return {
        id: Math.max(...gameState.homies.map(h => h.id), ...gameState.potentialRecruits.map(r => r.id)) + 1,
        name: gangNicknameGenerator.generateUniqueNickname(existingNames),
        strength,
        cost,
        weaponsCost
      };
    });
    
    gameState.recruitSystem.nextRefresh = now + gameState.recruitSystem.refreshInterval;
    
    updateRecruitList();
    showNotification('New recruits have arrived!');
  }
}

function updateRecruitTimer() {
  if (!gameState.recruitSystem || !gameState.recruitSystem.nextRefresh) {
    gameState.recruitSystem = {
      nextRefresh: new Date().getTime() + 3600000,
      refreshInterval: 3600000,
      baseRecruits: gameState.recruitSystem?.baseRecruits || []
    };
  }

  const now = new Date().getTime();
  const timeLeft = gameState.recruitSystem.nextRefresh - now;
  
  if (timeLeft <= 0) {
    refreshRecruits();
    return;
  }
  
  const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
  
  const timerElement = document.getElementById('recruit-timer');
  if (timerElement) {
    timerElement.textContent = `Next batch in: ${minutes}m ${seconds}s`;
  }
}

function updateRecruitList() {
  const recruitList = document.getElementById('recruit-list');
  const recruitSection = document.querySelector('.recruit-section');
  
  if (!document.querySelector('.recruit-section-header')) {
    const header = document.createElement('div');
    header.className = 'recruit-section-header';
    header.innerHTML = `
      <div>
        <h2>Recruit New Homies</h2>
        <span id="recruit-timer"></span>
      </div>
      <button class="refresh-button" onclick="refreshRecruits(true)">Force Refresh</button>
    `;
    recruitSection.insertBefore(header, recruitList);
  }
  
  recruitList.innerHTML = '';
  
  gameState.potentialRecruits.forEach(recruit => {
    const recruitCard = document.createElement('div');
    recruitCard.className = 'recruit-card';
    recruitCard.innerHTML = `
      <h3>${recruit.name}</h3>
      <p>Strength: ${recruit.strength}</p>
      <div class="recruit-cost">
        <p>Cost: $${recruit.cost}</p>
        <p>Weapons needed: ${recruit.weaponsCost}</p>
      </div>
      <button onclick="recruitHomie(${recruit.id})">Recruit</button>
    `;
    recruitList.appendChild(recruitCard);
  });
}

// Initialize WebSocket connection
const room = new WebsimSocket();

// Territory management
function openConquestModal() {
  const modal = document.getElementById('conquestModal');
  modal.style.display = 'flex';
  updateTerritoriesDisplay();
}

function closeConquestModal() {
  const modal = document.getElementById('conquestModal');
  modal.style.display = 'none';
  gameState.territories.selectedTerritory = null;
}

function updateTerritoriesDisplay() {
  const grid = document.getElementById('territories-grid');
  grid.innerHTML = '';
  
  // Display all connected players' territories
  for (const clientId in room.party.peers) {
    const { username } = room.party.peers[clientId];
    const isOwned = clientId === room.party.client.id;
    const isUnderAttack = gameState.territories.attackingForces[clientId];
    
    const card = document.createElement('div');
    card.className = `territory-card ${isOwned ? 'owned' : ''} ${isUnderAttack ? 'under-attack' : ''}`;
    card.innerHTML = `
      <h3>${username}'s Territory</h3>
      <p>Status: ${isOwned ? 'Your Territory' : isUnderAttack ? 'Under Attack' : 'Attackable'}</p>
      ${!isOwned ? `<button onclick="selectTerritory('${clientId}')" class="conquest-action">Select Target</button>` : ''}
    `;
    grid.appendChild(card);
  }
}

function selectTerritory(territoryId) {
  gameState.territories.selectedTerritory = territoryId;
  showNotification('Territory selected for attack');
}

function sendHomies() {
  const territoryId = gameState.territories.selectedTerritory;
  if (!territoryId) {
    showNotification('Select a territory first!');
    return;
  }
  
  const homiesToSend = parseInt(document.getElementById('homies-to-send').value);
  const availableHomies = gameState.homies.filter(h => !h.assigned).length;
  
  if (homiesToSend > availableHomies) {
    showNotification('Not enough available homies!');
    return;
  }
  
  // Send attack event
  room.send({
    type: 'territory_attack',
    targetId: territoryId,
    homies: homiesToSend
  });
  
  showNotification(`Sending ${homiesToSend} homies to attack!`);
}

// Add to room.onmessage handler
room.onmessage = (event) => {
  const data = event.data;
  switch (data.type) {
    case 'territory_attack':
      handleTerritoryAttack(data);
      break;
    // ... existing cases ...
  }
};

function handleTerritoryAttack(data) {
  if (data.targetId === room.party.client.id) {
    showNotification(`${data.username} is attacking your territory with ${data.homies} homies!`);
    // Handle defense logic here
  }
}

// Subscribe to peer presence changes
room.party.subscribePresence((presence) => {
  updateTerritoriesDisplay();
});

// Game loop
setInterval(() => {
  Object.entries(gameState.buildings).forEach(([buildingId, building]) => {
    if (building.homies.length > 0) {
      switch(buildingId) {
        case 'drug-lab':
          gameState.resources.drugs += building.production * building.homies.length;
          break;
        case 'weapons-factory':
          gameState.resources.weapons += building.production * building.homies.length;
          break;
        case 'counterfeit':
          gameState.resources.cash += building.production * building.homies.length;
          break;
        case 'gangbangers-base':
          gameState.resources.respect += building.production * building.homies.length;
          break;
        case 'hospital':
          gameState.resources.health += building.production * building.homies.length;
          break;
        case 'distillery-den':
          gameState.resources.liquor += building.production * building.homies.length;
          break;
        case 'gasoline-syndicate':
          gameState.resources.gasoline += building.production * building.homies.length;
          break;
      }
    }
  });
  
  updateResources();
  updateProductionRates();
  updateRecruitTimer();
}, 1000);

// Close version modal function
function closeVersionModal() {
  document.getElementById('version-modal').style.display = 'none';
}

// Initialize the game
window.onload = function() {
  setTimeout(() => {
    document.getElementById('loading-screen').style.display = 'none';
    document.getElementById('version-modal').style.display = 'block';
    document.getElementById('title-screen').style.display = 'flex';
    
    for (let i = 1; i <= 3; i++) {
      const savedData = localStorage.getItem(`gangstar-save-${i}`);
      if (savedData) {
        const data = JSON.parse(savedData);
        const loadBtn = document.getElementById(`slot${i}-load`);
        loadBtn.textContent = `Load Game (Saved: ${new Date(data.lastSaved).toLocaleDateString()})`;
      }
    }
  }, 2000);
  
  updateProductionRates();
  refreshRecruits();
};

// Add autosave every 30 seconds
setInterval(saveGame, 30000);

// Initial updates
updateResources();
updateRecruitList();
</script>

<footer style="margin-top: 20px; text-align: center; color: #666;">
  <p>Note: More buildings and features coming soon in future updates!</p>
  <p>Current Version: 2.0 Live</p>
</footer>

</div>
</body></html>
